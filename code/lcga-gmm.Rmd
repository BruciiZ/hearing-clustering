---
title: "LCGA and GMM"
author: "Bruce Zhou"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lcmm)
library(haven)
```

## Data Wrangling

```{r data wrangling}
rm(list=ls())
setwd('/Users/bruce/Desktop/Prof. Wang lab/hearing-clustering')

df <- read_xpt("data/P_AUX.XPT")
var_list <- c('SEQN',
              'AUXU500L', 'AUXU1K1L', 'AUXU2KL', 'AUXU3KL', 'AUXU4KL', 'AUXU6KL', 'AUXU8KL')
df <- df %>%
  select(all_of(var_list)) %>%
  pivot_longer(cols = all_of(var_list[-1]), names_to = "Frequency", values_to = "Threshold") %>%
  filter(Threshold != 888 & Threshold != 666 & !is.na(Threshold))

df <- df %>%
  arrange(SEQN) %>%
  group_by(SEQN) %>%
  mutate(Frequency = row_number()) %>%
  ungroup()
```

## Growth Mixture Model

```{r GMM analysis}
set.seed(2002)
gmm1_2 <- hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 1, data = df)

gmm2_2 <- gridsearch(rep = 10, maxiter = 10, minit = gmm1_2, hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 2, data = df, mixture = ~ Frequency, nwg=T))

gmm3_2 <- gridsearch(rep = 10, maxiter = 10, minit = gmm1_2, hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 3, data = df, mixture = ~ Frequency, nwg=T))

gmm4_2 <- gridsearch(rep = 10, maxiter = 10, minit = gmm1_2, hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 4, data = df, mixture = ~ Frequency, nwg=T))

gmm5_2 <- gridsearch(rep = 10, maxiter = 10, minit = gmm1_2, hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 5, data = df, mixture = ~ Frequency, nwg=T))

gmm6_2 <- gridsearch(rep = 10, maxiter = 10, minit = gmm1_2, hlme(Threshold ~ Frequency, subject = "SEQN", random= ~ 1 + Frequency, ng = 6, data = df, mixture = ~ Frequency, nwg=T))
# make table with results for the 4 models: summarytable(gmm1_2, gmm2_2, gmm3_2)
```

```{r summaryTable}
summarytable(gmm3_2, gmm4_2,gmm5_2,gmm6_2)
```




